#include "ScannerS/Tools/C2HEDM.hpp"
#include "catch.hpp"

TEST_CASE("EDM", "[unit][edm]") {
  SECTION("Type 1") {
    ScannerS::Tools::C2HEDMInput<3> in;
    in.mHi[0] = 125.09;
    in.mHi[1] = 113.072;
    in.mHi[2] = 115.536;
    in.mHp = 146.674;
    in.c_Hff[0][0][0] = -1.0053180955268932;
    in.c_Hff[0][0][1] = -0.015147504846981342;
    in.c_Hff[0][1][0] = -1.0053180955268932;
    in.c_Hff[0][1][1] = 0.015147504846981342;
    in.c_Hff[0][2][0] = -1.0053180955268932;
    in.c_Hff[0][2][1] = 0.015147504846981342;
    in.c_HVV[0] = -0.998445736515799;
    in.c_HHpHm[0] = 0.8012010342588423;
    in.c_Hff[1][0][0] = -0.23687631107927845;
    in.c_Hff[1][0][1] = -0.1102862762657017;
    in.c_Hff[1][1][0] = -0.23687631107927845;
    in.c_Hff[1][1][1] = 0.1102862762657017;
    in.c_Hff[1][2][0] = -0.23687631107927845;
    in.c_Hff[1][2][1] = 0.1102862762657017;
    in.c_HVV[1] = 0.04019376759972848;
    in.c_HHpHm[1] = -0.4183784410051371;
    in.c_Hff[2][0][0] = 0.14933162789102056;
    in.c_Hff[2][0][1] = -0.27691566477410523;
    in.c_Hff[2][1][0] = 0.14933162789102056;
    in.c_Hff[2][1][1] = 0.27691566477410523;
    in.c_Hff[2][2][0] = 0.14933162789102056;
    in.c_Hff[2][2][1] = 0.27691566477410523;
    in.c_HVV[2] = 0.03860793026779176;
    in.c_HHpHm[2] = 0.12058023924989536;
    auto x = ScannerS::Tools::calcElectronEDM(in);
    CHECK(x.contribF / 1.97327e-14 * 1e17 == Approx(-5.220419162803325));
    CHECK(x.contribHp / 1.97327e-14 * 1e16 == Approx(1.3877411896386417));
    CHECK(x.contribW / 1.97327e-14 * 1e16 == Approx(-8.544464324717789));
    CHECK(x.contribHpW / 1.97327e-14 * 1e17 == Approx(-4.370789535468111));
    CHECK(x.value / 1.97327e-14 * 1e16 == Approx(-8.115844004906291));
  }
  SECTION("Type 2") {
    ScannerS::Tools::C2HEDMInput<3> in;
    in.mHi[0] = 125.09;
    in.mHi[1] = 88.0659;
    in.mHi[2] = 622.737;
    in.mHp = 606.518;
    in.c_Hff[0][0][0] = 1.0008049210125582;
    in.c_Hff[0][0][1] = -0.019875895184194727;
    in.c_Hff[0][1][0] = 1.0008049210125582;
    in.c_Hff[0][1][1] = 0.019875895184194727;
    in.c_Hff[0][2][0] = 1.0008049210125582;
    in.c_Hff[0][2][1] = 0.019875895184194727;
    in.c_HVV[0] = 0.9762619703363763;
    in.c_HHpHm[0] = -11.891895387803132;
    in.c_Hff[1][0][0] = -0.0837353200989388;
    in.c_Hff[1][0][1] = -0.10642784338720467;
    in.c_Hff[1][1][0] = -0.0837353200989388;
    in.c_Hff[1][1][1] = 0.10642784338720467;
    in.c_Hff[1][2][0] = -0.0837353200989388;
    in.c_Hff[1][2][1] = 0.10642784338720467;
    in.c_HVV[1] = 0.015907668466849892;
    in.c_HHpHm[1] = -0.47956088237069494;
    in.c_Hff[2][0][0] = -0.11242285105986877;
    in.c_Hff[2][0][1] = -0.09766808146999684;
    in.c_Hff[2][1][0] = -0.11242285105986877;
    in.c_Hff[2][1][1] = 0.09766808146999684;
    in.c_Hff[2][2][0] = -0.11242285105986877;
    in.c_Hff[2][2][1] = 0.09766808146999684;
    in.c_HVV[2] = -0.2160081279926405;
    in.c_HHpHm[2] = 1.6143555748694585;
    auto x = ScannerS::Tools::calcElectronEDM(in);
    CHECK(x.contribF / 1.97327e-14 * 1e16 == Approx(-8.643464544773292));
    CHECK(x.contribHp / 1.97327e-14 * 1e15 == Approx(1.9637823615702577));
    CHECK(x.contribW / 1.97327e-14 * 1e14 == Approx(-1.6263272826990714));
    CHECK(x.contribHpW / 1.97327e-14 * 1e16 == Approx(5.742765727123542));
    CHECK(x.value / 1.97327e-14 * 1e14 == Approx(-1.458956034718543));
  }
}
